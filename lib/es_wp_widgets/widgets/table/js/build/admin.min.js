!function(a){if("undefined"==typeof b){var b=function(a,b){this.__construct(a,b)},c=b.prototype,d=b;c.dom=null,c.data=null,c.str_data="",c.__construct=function(b,c){var e=this;b=a(b),this.dom={},this.dom.widget=b,this.dom.form=this.dom.widget.find("form"),this.dom.table_container=this.dom.widget.find(".es_table_container"),this.dom.table_wrapper=a('<div class="es_table_wrapper"></div>'),this.dom.table=a('<table class="es_table"></table>'),this.dom.table.appendTo(this.dom.table_wrapper),this.dom.tbody=a("<tbody></tbody>"),this.dom.tbody.appendTo(this.dom.table),this.dom.keyboard_shortcuts_link=this.dom.form.find(".es-cfct-keyboard-shortcuts-link"),this.dom.keyboard_shortcuts=this.dom.form.find(".es-cfct-keyboard-shortcuts"),this.dom.data_input_el=this.dom.form.find("input.es-cfct-table-data"),("object"!=typeof c||d.get_object_size(c)<1)&&(c=d.decode(this.dom.data_input_el.val())),null==c&&(c=d.get_blank_data()),this.set_values(c,!1),this.dom.tbody.sortable({axis:"y",helper:function(b,c){return c.children().each(function(){a(this).width(a(this).width())}),c},start:function(b,c){c.placeholder.height(a(c.item[0]).height()),e.remove_remove_buttons(),e.remove_column_move_buttons()},stop:function(b,c){e.attach_remove_buttons(),e.attach_column_move_buttons(),e.set_values(),d.highlight(a(c.item[0]).find("td"))}}),this.data_to_html(c),this.dom.tbody.on("click",".es_row_remove_btn",function(b){b.preventDefault();var c=a(this).closest("tr");return e.remove_row(c),!1}),this.dom.tbody.on("click",".es_col_remove_btn",function(b){return b.preventDefault(),e.remove_column(a(this)),!1}),this.attach_remove_buttons(),this.dom.tbody.on("click",".es_col_move_left_btn",function(b){b.preventDefault();var c=a(this).closest("td");return e.move_column(c,!0),!1}),this.dom.tbody.on("click",".es_col_move_right_btn",function(b){b.preventDefault();var c=a(this).closest("td");return e.move_column(c,!1),!1}),this.attach_column_move_buttons(),a(this.dom.tbody).on("click","td, th",function(b){var c=a(this);return c.hasClass("edit_active")?(b.stopPropagation(),void 0):(e.close_and_apply_inputs(),e.begin_cell_edit(this),!1)}),a(this.dom.tbody).on("keydown","textarea",function(b){var c=a(this),d=b.which;if("9"==d){b.preventDefault(),b.stopPropagation();var c=a(this),f=c.closest("td");b.shiftKey?e.next_cell(f,!0):e.next_cell(f,!1)}else if(13!=d||b.shiftKey){if(b.altKey&&38==d){b.preventDefault(),b.stopPropagation();var g=c.closest("tr"),f=c.closest("td");e.move_row(g,!0),e.set_cell_focus(f)}else if(b.altKey&&40==d){b.preventDefault(),b.stopPropagation();var g=c.closest("tr"),f=c.closest("td");e.move_row(g,!1),e.set_cell_focus(f)}else if(b.altKey&&82==d)b.preventDefault(),b.stopPropagation(),e.add_row();else if(b.altKey&&67==d)b.preventDefault(),b.stopPropagation(),e.add_column();else if(b.altKey&&37==d){b.preventDefault(),b.stopPropagation();var f=c.closest("td");e.move_column(f,!0),e.set_cell_focus(f)}else if(b.altKey&&39==d){b.preventDefault(),b.stopPropagation();var f=c.closest("td");e.move_column(f,!1),e.set_cell_focus(f)}else if(b.altKey&&8==d){b.preventDefault(),b.stopPropagation();var g=c.closest("tr");e.remove_row(g,!0)}}else b.preventDefault(),b.stopPropagation(),e.close_and_apply_inputs()}),this.dom.table_container.closest(".cfct-popup-content, .widget-inside").click(function(b){var c=a(b.toElement);c.is(".es_table_add_row, .es_table_add_col")||e.close_and_apply_inputs()});var f=a('<div class="es_table_controls"></div>');a('<a class="es_table_add_row button-primary">Add Row</a>').click(function(a){a.preventDefault(),e.add_row()}).appendTo(f),a('<a class="es_table_add_col button-primary">Add Column</a>').click(function(a){a.preventDefault(),e.add_column()}).appendTo(f),this.dom.table_container.prepend(f),new ES_Widget_Advanced_Options(this.dom.form.find(".es-widget-form-advanced-options"),{auto_open:!0}),this.dom.keyboard_shortcuts_link.click(function(b){b.preventDefault();var c=a(this);e.dom.keyboard_shortcuts.is(":visible")?(c.text("Show Keyboard Shortcuts"),e.dom.keyboard_shortcuts.hide()):(c.text("Hide Keyboard Shortcuts"),e.dom.keyboard_shortcuts.show())});var g=new ES_Widget_Options_Watcher(b);g.subscribe(".es-cfct-table-first-row-headings",function(){e.toggle_first_row_headings(a(this))}),g.trigger_all(),this.dom.table_container.append(this.dom.table_wrapper)},c.add_row=function(){var a=this.dom.tbody.find("> tr").first().find("td"),b=a.length,c=d.get_row_template(b);this.dom.tbody.append(c),this.reattach_remove_buttons();var e=c.find("td:first-child");this.close_and_apply_inputs(),this.begin_cell_edit(e),d.highlight(c.find("td"))},c.remove_row=function(b,c){var d=b.index(),e=b.prev("tr");if(0!=d){if(confirm("Are you sure you want to remove this Row?")){var b=this.dom.tbody.find("> tr")[d];a(b).remove(),this.reattach_remove_buttons(),this.set_values()}"undefined"==typeof c&&(c=!1),c&&this.begin_cell_edit(e.find("td:first-child"))}},c.move_row=function(b,c){this.remove_remove_buttons(),this.remove_column_move_buttons(),b=a(b),"undefined"==typeof c&&(c=!1),c?b.is(":first-child")?b.appendTo(this.dom.tbody):b.insertBefore(b.prev("tr")):b.is(":last-child")?b.prependTo(this.dom.tbody):b.insertAfter(b.next("tr")),this.attach_remove_buttons(),this.attach_column_move_buttons(),this.set_values(),d.highlight(b.find("td"))},c.add_column=function(){var b=this.dom.tbody.find("> tr"),c=!1;b.first().find("td").length<1&&(c=!0);var e,f=a();b.each(function(b,g){g=a(g),b>0&&(c=!1),e=d.get_col_template(null,c),f=f.add(e),g.append(e)}),this.reattach_remove_buttons(),this.reattach_column_move_buttons();var g=this.dom.tbody.find("tr:first-child td:last-child");this.close_and_apply_inputs(),this.begin_cell_edit(g),d.highlight(f)},c.remove_column=function(b){var c=b.closest("td").index();if(0!=c){if(confirm("Are you sure you want to remove this Column?")){var d=this.dom.tbody.find("> tr");d.each(function(b,d){d=a(d);var e=d.find("td")[c];a(e).remove()}),this.reattach_remove_buttons(),this.set_values()}return!1}},c.move_column=function(b,c){this.remove_remove_buttons(),b=a(b),"undefined"==typeof c&&(c=!1);var e=b.index(),f=b.is(":first-child"),g=b.is(":last-child"),h=this.dom.tbody.find("tr"),i=a();h.each(function(b,d){d=a(d);var h=a(d.find("td")[e]);i=i.add(h),c?f?h.appendTo(d):h.insertBefore(h.prev("td")):g?h.prependTo(d):h.insertAfter(h.next("td"))}),this.attach_remove_buttons(),this.set_values(),d.highlight(i)},c.toggle_first_row_headings=function(a){a.is(":checked")?this.dom.table.addClass("es_table_has_headings"):this.dom.table.removeClass("es_table_has_headings")},c.reattach_remove_buttons=function(){this.remove_remove_buttons(),this.attach_remove_buttons()},c.remove_remove_buttons=function(){this.dom.tbody.find(".es_row_remove_btn, .es_col_remove_btn").remove()},c.attach_remove_buttons=function(){var b=this.dom.tbody.find("> tr");b.each(function(c,d){d=a(d);var e=d.find("td, th");c>0&&e.last().append('<a class="es_row_remove_btn" title="Click to remove this Row"></a>'),c==b.length-1&&e.each(function(b,c){c=a(c),b>0&&c.append('<a class="es_col_remove_btn" title="Click to remove this Column"></a>')})})},c.reattach_column_move_buttons=function(){this.remove_column_move_buttons(),this.attach_column_move_buttons()},c.remove_column_move_buttons=function(){this.dom.tbody.find(".es_col_move_btn").remove()},c.attach_column_move_buttons=function(){var b=this.dom.tbody.find("> tr:first-child td");b.each(function(b,c){c=a(c),c.append('<a class="es_col_move_btn es_col_move_left_btn" title="Click to move this column Left"></a>'),c.append('<a class="es_col_move_btn es_col_move_right_btn" title="Click to move this column Right"></a>')})},c.html_to_data=function(){var b=new Array;this.dom.tbody.find("> tr").each(function(c,d){d=a(d);var e=new Array;d.find("> td").each(function(b,c){c=a(c);var d=c.find(".col_content").html(),f=c.find("input").is(":checked");e.push({content:d,html:f})}),b.push(e)});var c={};return c.rows=b,c},c.data_to_html=function(b){var c,e,f,g,h,i,j=b.rows;for(var k in j){h=a("<tr></tr>"),c=j[k];for(var l in c)e=c[l],f=e.content,g=e.html,i=d.get_col_template(f,g),h.append(i);this.dom.tbody.append(h)}},c.close_and_apply_inputs=function(){var b=this.dom.tbody.find("td textarea"),c=this.dom.tbody.find("td label"),e=this.dom.tbody.find(".col_content");b.each(function(b,c){var e=a(c),f=e.siblings("label").find("input"),g=e.siblings(".col_content"),h=e.closest("td");if(h.hasClass("edit_active")){h.removeClass("edit_active");var i=e.val();f.is(":checked")?g.html(i):g.html(_.escape(i)),e.hide(),d.highlight(h)}}),c.hide(),e.show(),this.set_values()},c.begin_cell_edit=function(b){b=a(b),b.addClass("edit_active");var c=b.find(".col_content"),d=b.find("textarea"),e=b.find("label");c.hide(),d.show(),e.show(),this.set_cell_focus(b)},c.set_cell_focus=function(a){var b=a.find("textarea");b.focus(),tmpStr=b.val(),b.val(""),b.val(tmpStr),b.select()},c.next_cell=function(a,b){"undefined"==typeof b&&(b=!1);var c;if(b)if(a.is(":first-child")){var d=a.closest("tr");c=d.is(":first-child")?this.dom.tbody.find("tr:last-child td:last-child"):d.prev("tr").find("td:last-child")}else c=a.prev("td");else if(a.is(":last-child")){var d=a.closest("tr");c=d.is(":last-child")?this.dom.tbody.find("tr:first-child td:first-child"):d.next("tr").find("td:first-child")}else c=a.next("td");this.close_and_apply_inputs(),this.begin_cell_edit(c)},c.set_values=function(a,b){"undefined"!=typeof a&&a||(a=this.html_to_data()),"undefined"==typeof b&&(b=!0),this.data=a,this.str_data=d.encode(a),!0===b&&this.dom.data_input_el.val(this.str_data)},d.get_row_template=function(b){for(var c=a("<tr></tr>"),e=0;b>e;e++)c.append(d.get_col_template(null));return c},d.get_col_template=function(b,c){c="undefined"==typeof c?!1:c,"undefined"!=typeof b&&b||(b="Click to Edit...");var d=a("<td></td>").append('<div class="col_content">'+b+"</div>").append("<textarea>"+b+"</textarea>").append('<label><input type="checkbox" '+(c?'checked="checked"':"")+" /> HTML?</label>");return d},d.get_blank_data=function(){for(var a,b,c=2,d=2,e={},f=new Array,g=0;c>g;g++){a=new Array;for(var h=0;d>h;h++)b="Click to Edit...",a.push(b);f.push(a)}return e.rows=f,e},d.get_object_size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},d.encode=function(a){try{return encodeURIComponent(JSON.stringify(a))}catch(b){return null}},d.decode=function(a){try{return JSON.parse(decodeURIComponent(a))}catch(b){return null}},d.highlight=function(a){a.attr("style",function(a,b){return b?b.replace(/background-color[^;]+;?/g,""):void 0}),a.stop().effect("highlight",{duration:1e3,color:"rgba(254, 254, 160, 0.51)"})}}window.ES_Table=b}(jQuery);