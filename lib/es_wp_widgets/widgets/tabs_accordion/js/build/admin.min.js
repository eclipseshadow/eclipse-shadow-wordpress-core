!function(a){if("undefined"==typeof b){var b=function(a,b){this.__construct(a,b)},c=b.prototype,d=b;c.dom=null,c.data=null,c.str_data="",c.__construct=function(b,c){var e=this;b=a(b),this.dom={},this.dom.widget=b,this.dom.dialog_parent=b.find(".widget-inside, .cfct-module-edit-form"),this.dom.form=this.dom.widget.find("form"),this.dom.tabs_container=this.dom.widget.find(".es_tabs_container"),this.dom.tabs_wrapper=a('<div class="es_tabs_wrapper"></div>').appendTo(this.dom.tabs_container),this.dom.tabs_link_container=a('<ul class="es_tabs_link_container"></ul>').appendTo(this.dom.tabs_wrapper),this.dom.tabs_content_container=a('<div class="es_tabs_content_container"></div>').appendTo(this.dom.tabs_wrapper),this.dom.data_input_el=this.dom.form.find("input.es-cfct-tabs-accordion-data"),("object"!=typeof c||d.get_object_size(c)<1)&&(c=d.decode(this.dom.data_input_el.val())),null==c&&(c=d.get_blank_data()),this.set_values(c,!1),this.data_to_html(c),this.dom.tabs_container.append(this.dom.tabs_wrapper),this.dom.tabs_wrapper.tabs({keyboard:!1});var f=a('<div class="es_tabs_controls"></div>');a('<a class="es_tabs_add_row button-primary">Add Tab</a>').click(function(a){a.preventDefault(),e.dialog("add_tab")}).appendTo(f),this.dom.tabs_container.prepend(f),this.dom.tabs_link_container.on("click",".es_remove_tab_btn",function(b){b.preventDefault();var c=a(this).closest("li");return e.remove_tab(c),!1}),this.dom.tabs_link_container.on("click",".es_edit_tab_btn",function(b){b.preventDefault();var c=a(this).closest("li");return e.edit_tab_title(c),!1}),this.initialize_sortable_tabs(),this.dom.tabs_content_container.on("click",".es_tab_content_add_item_btn",function(a){return a.preventDefault(),e.dialog("add_tab_item"),!1}),this.dom.tabs_content_container.on("click",".es_tab_content_item_remove_btn",function(b){b.preventDefault();var c=a(this),d=c.closest(".es_tab_content_item");return e.remove_tab_item(d),!1}),this.dom.tabs_content_container.on("click",".es_tab_content_item_edit_btn",function(b){b.preventDefault();var c=a(this),d=c.closest(".es_tab_content_item");return e.dialog("configure_tab_item_"+d.data("type"),{item:d}),!1}),this.initialize_sortable_tab_items(),new ES_Widget_Advanced_Options(this.dom.form.find(".es-widget-form-advanced-options"))},c.add_tab=function(a,b){var c=this.dom.tabs_link_container.find("> li").length,e="tab-"+c,f=d.get_tab_link_template(a,e),g=d.get_tab_content_template(b,e);return this.dom.tabs_link_container.append(f),this.dom.tabs_content_container.append(g),this.dom.tabs_wrapper.tabs("refresh"),this.initialize_sortable_tab_items(),this.initialize_sortable_tabs(),this.set_values(),f},c.remove_tab=function(a){if(confirm("Are you sure you want to delete this Tab?")){var b=this.dom.tabs_content_container.find(a.find("a").attr("href"));a.remove(),b.remove(),this.dom.tabs_wrapper.tabs("refresh"),this.initialize_sortable_tab_items(),this.initialize_sortable_tabs(),this.set_values()}},c.edit_tab_title=function(b){var c=this,d=b.find("a");d.hide();var e=function(d){var f=a(d.toElement);(!f.is(".ui-tabs-nav *")||f[0]!=b[0]&&f.closest("li")[0]!=b[0])&&c.close_and_apply_tab_title(b,e)},f=a('<input type="text" value="'+d.text()+'" />');f.bind("keydown",function(a){var d=a.which;13!=d||a.shiftKey?a.stopPropagation():c.close_and_apply_tab_title(b,e)}),b.append(f),f.focus(),tmpStr=f.val(),f.val(""),f.val(tmpStr),f.select(),this.dom.widget.click(e)},c.close_and_apply_tab_title=function(a,b){this.dom.widget.unbind("click",b);var c=a.find("a"),d=a.find("input");c.text(d.val()).show(),d.remove(),this.set_values()},c.add_tab_item=function(a,b){var c=this.dom.tabs_content_container.find('div[aria-hidden="false"], div[aria-expanded="true"]');if(c.length>1)throw'ES Tabs - More than 1 "Active Tab" return in Method: add_tab_item()';var e=d.get_tab_item_template(a);if(b)b.replaceWith(e);else{var f=c.find("> .es_tab_content_item").last();f.length<1?c.prepend(e):e.insertAfter(f)}this.initialize_sortable_tab_items(),this.set_values()},c.remove_tab_item=function(a){confirm("Are you sure you want to remove this item?")&&(a.remove(),this.initialize_sortable_tab_items(),this.set_values())},c.initialize_sortable_tabs=function(){var b=this;try{this.dom.tabs_link_container.sortable("refresh")}catch(c){this.dom.tabs_link_container.sortable({axis:"x",items:"> li",distance:5,stop:function(){b.dom.tabs_wrapper.tabs("refresh");var c=b.dom.tabs_link_container.find("li");c.each(function(c,d){d=a(d),tab_id=d.find("a").attr("href");var e=b.dom.tabs_content_container.find(tab_id);e.appendTo(b.dom.tabs_content_container)}),b.set_values()}})}},c.initialize_sortable_tab_items=function(){var a=this;try{this.dom.tabs_content_container.sortable("refresh")}catch(b){this.dom.tabs_content_container.sortable({axis:"y",items:"> .es_tab_content > .es_tab_content_item",distance:5,stop:function(){a.set_values()}})}},c.html_to_data=function(){var b=this.dom.tabs_link_container.find("> li"),c=this.dom.tabs_content_container.find("> div"),e={};return e.tabs=new Array,b.each(function(b,c){c=a(c);var d=c.find("a").text();e.tabs.push({tab_name:d})}),c.each(function(b,c){c=a(c);var f=new Array,g=c.find("> .es_tab_content_item");g.each(function(b,c){c=a(c);var e=d.get_item_data(c);f.push(e)}),e.tabs[b].tab_items=f}),e},c.data_to_html=function(b){var c,e,f,g,h,i,j=b.tabs;for(var k in b.tabs){c=j[k],e="tab-"+k,i=a();for(var l in c.tab_items)h=c.tab_items[l],i=i.add(d.get_tab_item_template(h));f=d.get_tab_link_template(c.tab_name,e),g=d.get_tab_content_template(i,e),this.dom.tabs_link_container.append(f),this.dom.tabs_content_container.append(g)}},c.set_values=function(a,b){"undefined"!=typeof a&&a||(a=this.html_to_data()),"undefined"==typeof b&&(b=!0),this.data=a,this.str_data=d.encode(a),!0===b&&this.dom.data_input_el.val(this.str_data)},c.dialog=function(b,c){var d=this;switch(b){case"add_tab":var e=a('<div class="es_dialog" title="Add Tab"><form><fieldset class="ui-helper-reset"><label for="tab_name">Tab Name</label><input type="text" name="tab_name" id="tab_name" value="" class="widefat ui-widget-content ui-corner-all" /></fieldset></form>').appendTo(document.body),f=function(){var a=e.find('input[name="tab_name"]').val(),b=d.add_tab(a);b.find("a").trigger("click"),e.dialog("close")},g=function(){a(this).dialog("close")},h=function(){e.find("form")[0].reset(),e.remove()};e.find("form").submit(function(a){a.preventDefault(),f()}),e.dialog({autoOpen:!0,width:d.dom.dialog_parent.outerWidth(),height:d.dom.dialog_parent.outerHeight(),modal:!1,appendTo:d.dom.dialog_parent,buttons:{Add:function(){f()},Cancel:g},close:h});break;case"add_tab_item":var i,e=a('<div class="es_dialog" title="Add Tab Item"><form><fieldset class="ui-helper-reset"><p>Choose the type of item you\'d like to add to your <strong>Tab</strong>.</p><div class="es_tab_item_options"><a href="#" class="es_tab_item_option" data-item-type="rich_text"><span class="es_icon es_icon_rich_text"><span class="es_icon_inner"></span></span><span class="es_tab_item_option_label">Rich Text</span></a><a href="#" class="es_tab_item_option" data-item-type="raw_html"><span class="es_icon es_icon_raw_html"><span class="es_icon_inner"></span></span><span class="es_tab_item_option_label">Raw HTML/JS</span></a><a href="#" class="es_tab_item_option" data-item-type="widget_area"><span class="es_icon es_icon_widget_area"><span class="es_icon_inner"></span></span><span class="es_tab_item_option_label">Widget Area<br /><em>(sidebar)</em></span></a><a href="#" class="es_tab_item_option" data-item-type="server_page"><span class="es_icon es_icon_callout"><span class="es_icon_inner"></span></span><span class="es_tab_item_option_label">Server Page</span></a></div></fieldset></form></div>').appendTo(document.body);e.find("a").click(function(b){b.preventDefault();var c=a(this),e=c.data("item-type");i.dialog("close"),d.dialog("configure_tab_item_"+e)});var g=function(){a(this).dialog("close")},h=function(){e.find("form")[0].reset(),e.remove()};e.find("form").submit(function(a){a.preventDefault()}),i=e.dialog({width:d.dom.dialog_parent.outerWidth(),height:d.dom.dialog_parent.outerHeight(),resizable:!1,autoOpen:!0,modal:!1,appendTo:d.dom.dialog_parent,buttons:{Cancel:g},close:h});break;case"configure_tab_item_rich_text":var j,e=a('<div class="es_dialog" title="Add Your Rich Text"><form><fieldset class="ui-helper-reset"><div class="es_rich_text_container"></div></fieldset></form></div>').appendTo(document.body),k=function(){var b=j.get_editor().getContent();a.trim(a(b).find("p").first().html()).length<1&&(b=b.replace(/<p><\/p>/,"")),c&&c.item?d.add_tab_item({type:"rich_text",content:_.escape(b)},c.item):d.add_tab_item({type:"rich_text",content:_.escape(b)}),j.destroy(),a(this).dialog("close")},g=function(){j.destroy(),a(this).dialog("close")},l=function(){a(".ui-dialog :button").blur()},h=function(){e.find("form")[0].reset(),e.remove()};e.find("form").submit(function(a){a.preventDefault(),k()}),e.dialog({width:d.dom.dialog_parent.outerWidth(),height:d.dom.dialog_parent.outerHeight(),resizable:!0,autoOpen:!0,modal:!1,appendTo:d.dom.dialog_parent,buttons:{Save:k,Cancel:g},open:l,close:h}),j=new ES_WP_Rich_Text_Editor({element:e.find(".es_rich_text_container"),setup:function(a){a.onInit.add(function(a){c&&c.item&&a.setContent(_.unescape(c.item.data("content")))})}});break;case"configure_tab_item_raw_html":var j,e=a('<div class="es_dialog" title="Add Your Raw HTML/JS"><form><fieldset class="ui-helper-reset"><div class="es_raw_html_container"></div></fieldset></form></div>').appendTo(document.body),k=function(){var b=j.ace_editor.getValue(),e=j.ace_editor.getSession().getMode().$id.substring(9);c&&c.item?d.add_tab_item({type:"raw_html",content:_.escape(b),mode:e},c.item):d.add_tab_item({type:"raw_html",content:_.escape(b),mode:e}),a(this).dialog("close")},g=function(){a(this).dialog("close")},l=function(){a(".ui-dialog :button").blur()},h=function(){e.find("form")[0].reset(),e.remove(),j.destroy()};e.find("form").submit(function(a){a.preventDefault(),k()}),e.dialog({width:d.dom.dialog_parent.outerWidth(),height:d.dom.dialog_parent.outerHeight(),resizable:!0,autoOpen:!0,modal:!1,appendTo:d.dom.dialog_parent,buttons:{Save:k,Cancel:g},open:l,close:h}),j=new ES_ACE_Code_Editor({element:e.find(".es_raw_html_container"),width:"100%",height:250,mode:"html",auto_focus:!1}),c&&c.item&&(j.ace_editor.setValue(_.unescape(c.item.data("content"))),j.set_mode(c.item.data("mode")));break;case"configure_tab_item_widget_area":var e=a('<div class="es_dialog" title="Select a Widget Area"><form><fieldset class="ui-helper-reset"><label for="ajax_url">Widget Area</label><select class="widefat" name="widget_area"></select></fieldset></form></div>').appendTo(document.body),k=function(){var b=e.find('select[name="widget_area"]').val(),f=e.find('select[name="widget_area"] > option:selected').text();c&&c.item?d.add_tab_item({type:"widget_area",widget_area_name:f,widget_area_id:b},c.item):d.add_tab_item({type:"widget_area",widget_area_name:f,widget_area_id:b}),a(this).dialog("close")},g=function(){a(this).dialog("close")},h=function(){e.find("form")[0].reset(),e.remove()};e.find("form").submit(function(a){a.preventDefault(),k()}),e.dialog({width:d.dom.dialog_parent.outerWidth(),height:d.dom.dialog_parent.outerHeight(),resizable:!0,autoOpen:!0,modal:!1,appendTo:d.dom.dialog_parent,buttons:{Save:k,Cancel:g},close:h});var m={action:"es_cfct_tabs_accordion_get_widget_areas"};a.post(ajaxurl,m,function(a){var b,d,f,g,h=e.find('select[name="widget_area"]');for(var i in a.sidebars)b=a.sidebars[i],d=b.name,f=b.id,g=f,h.append('<option value="'+g+'">'+d+"</option>");if(c&&c.item){var j=c.item.data("widget_area_name");j=j.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()});var k=c.item.data("widget_area_id");h.val(k)}});break;case"configure_tab_item_server_page":var e=a('<div class="es_dialog" title="Specify Your Server Page"><form><fieldset class="ui-helper-reset"><label for="ajax_url">Server Page URL <em>(must be publicly accessible)</em></label><br /><input type="text" name="server_page_url" id="server_page_url" value="" class="widefat ui-widget-content ui-corner-all" /><br /><br /><input type="checkbox" name="load_via_ajax" id="load_via_ajax" class="ui-widget-content ui-corner-all" /><label for="load_via_ajax"> Load Via Ajax</label></fieldset></form></div>').appendTo(document.body),k=function(){var b=e.find('input[name="server_page_url"]').val(),f=e.find('input[name="load_via_ajax"]').is(":checked");c&&c.item?d.add_tab_item({type:"server_page",server_page_url:_.escape(b),load_via_ajax:f},c.item):d.add_tab_item({type:"server_page",server_page_url:_.escape(b),load_via_ajax:f}),a(this).dialog("close")},g=function(){a(this).dialog("close")},h=function(){e.find("form")[0].reset(),e.remove()};e.find("form").submit(function(a){a.preventDefault(),k()}),e.dialog({width:d.dom.dialog_parent.outerWidth(),height:d.dom.dialog_parent.outerHeight(),resizable:!0,autoOpen:!0,modal:!1,appendTo:d.dom.dialog_parent,buttons:{Save:k,Cancel:g},close:h}),c&&c.item&&(e.find('input[name="server_page_url"]').val(_.unescape(c.item.data("server_page_url"))),c.item.data("load_via_ajax")&&e.find('input[name="load_via_ajax"]').prop("checked",!0))}},d.get_tab_link_template=function(b,c){b||(b="Tab");var d=a('<li><a href="#'+c+'">'+b+'</a> <span class="es_edit_tab_btn ui-icon ui-icon-pencil" role="presentation">Edit Tab Title</span> <span class="es_remove_tab_btn ui-icon ui-icon-close" role="presentation">Remove Tab</span></li>');return d},d.get_tab_content_template=function(b,c){b||(b="");var d=a('<div class="es_tab_content" id="'+c+'"><div class="es_tab_content_controls"><a href="#" class="es_tab_content_add_item_btn button-primary">+ Add Item</a></div></div>');return d.prepend(b),d},d.get_tab_item_template=function(b){var c=null;if(!b)return c;switch(b.type){case"rich_text":var d=_.unescape(b.content),e=a("<span>"+d+"</span>").text(),f=/\[.+\]/g;e=e.replace(f,""),e.length>30&&(e=e.substring(0,50)+"..."),c=a('<div class="es_tab_content_item clearfix"></div>'),a('<div class="es_tab_content_item_preview"><span class="es_tab_content_item_preview_label">Rich Text: </span>'+e+"</div>").appendTo(c),a('<div class="es_tab_content_item_controls"><a href="" class="es_tab_content_item_edit_btn">Edit</a><a href="#" class="es_tab_content_item_remove_btn">Remove</a></div>').prependTo(c),c.attr("data-type",b.type),c.attr("data-content",_.escape(d));break;case"raw_html":var d=_.unescape(b.content),g=b.mode,e=_.escape(d);e.length>30&&(e=e.substring(0,50)+"..."),c=a('<div class="es_tab_content_item clearfix"></div>'),a('<div class="es_tab_content_item_preview"><span class="es_tab_content_item_preview_label">Raw '+("html"==g?"HTML":"Javascript")+": </span>"+e+"</div>").appendTo(c),a('<div class="es_tab_content_item_controls"><a href="" class="es_tab_content_item_edit_btn">Edit</a><a href="#" class="es_tab_content_item_remove_btn">Remove</a></div>').prependTo(c),c.attr("data-type",b.type),c.attr("data-content",_.escape(d)),c.attr("data-mode",g);break;case"widget_area":var h=b.widget_area_name,i=b.widget_area_id;h=h.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()});var e=h;e.length>30&&(e=e.substring(0,50)+"..."),c=a('<div class="es_tab_content_item clearfix"></div>'),a('<div class="es_tab_content_item_preview"><span class="es_tab_content_item_preview_label">Widget Area: </span>'+e+"</div>").appendTo(c),a('<div class="es_tab_content_item_controls"><a href="" class="es_tab_content_item_edit_btn">Edit</a><a href="#" class="es_tab_content_item_remove_btn">Remove</a></div>').prependTo(c),c.attr("data-type",b.type),c.attr("data-widget_area_name",h),c.attr("data-widget_area_id",i);break;case"server_page":var j=_.unescape(b.server_page_url),k=b.load_via_ajax,e=a("<span>"+j+"</span>").text();e.length>30&&(e=e.substring(0,50)+"..."),k&&(e+="<strong> - Ajax: True</strong>"),c=a('<div class="es_tab_content_item clearfix"></div>'),a('<div class="es_tab_content_item_preview"><span class="es_tab_content_item_preview_label">Server Page: </span>'+e+"</div>").appendTo(c),a('<div class="es_tab_content_item_controls"><a href="" class="es_tab_content_item_edit_btn">Edit</a><a href="#" class="es_tab_content_item_remove_btn">Remove</a></div>').prependTo(c),c.attr("data-type",b.type),c.attr("data-server_page_url",_.escape(j)),c.attr("data-load_via_ajax",k)}return c},d.get_blank_data=function(){var a=1,b={};b.tabs=new Array;for(var c=0;a>c;c++)b.tabs.push({tab_name:"Tab",tab_items:new Array});return b},d.get_object_size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},d.encode=function(a){try{return encodeURIComponent(JSON.stringify(a))}catch(b){return null}},d.decode=function(a){try{return JSON.parse(decodeURIComponent(a))}catch(b){return null}},d.get_item_data=function(b){b=a(b);var c=b.data();for(var d in c)b.is("[data-"+d+"]")||delete c[d];return c},d.highlight=function(a){a.attr("style",function(a,b){return b?b.replace(/background-color[^;]+;?/g,""):void 0}),a.stop().effect("highlight",{duration:1e3,color:"rgba(254, 254, 160, 0.51)"})}}window.ES_Tabs_Accordion=b}(jQuery);