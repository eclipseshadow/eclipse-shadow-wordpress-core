!function(a){if("undefined"==typeof b){var b=function(a,b){this.__construct(a,b)},c=b.prototype,d=b;c.dom=null,c.options=null,c.default_options={},c.__construct=function(b){var c=this;b=a(b),this.dom={},this.dom.widget=b,this.dom.form=this.dom.widget.find("form"),this.dom.image_preview=this.dom.form.find(".es-cfct-linked-image-image-preview"),this.dom.choose_image_btn=this.dom.form.find(".es-cfct-linked-image-choose-image-btn"),this.dom.link_to_object_search_results=this.dom.form.find(".es-cfct-linked-image-link-to-object-search-results"),this.dom.link_to_object_search_selection=this.dom.form.find(".es-cfct-linked-image-link-to-object-search-selection"),this.dom.link_to_object_settings=this.dom.form.find(".es-cfct-linked-image-link-to-object-settings"),this.dom.link_to_url_settings=this.dom.form.find(".es-cfct-linked-image-link-to-url-settings"),this.dom.input_image_ids=this.dom.form.find(".es-cfct-linked-image-image_ids"),this.dom.input_link_to_object_search=this.dom.form.find(".es-cfct-linked-image-link-to-object-search"),this.dom.input_link_to_object_id=this.dom.form.find(".es-cfct-linked-image-link_to_object_id"),this.dom.choose_image_btn.click(function(){c.launch_media_uploader()}),this.load_image_preview();var d=new ES_Widget_Options_Watcher(b);d.subscribe(".es-cfct-linked-image-link-to-checkbox",function(){c.toggle_link_to_settings()}),d.trigger_all(),this.dom.input_link_to_object_search.keyup(function(){c.link_to_object_search_on_change()}),this.dom.link_to_object_search_results.on("click",".es-cfct-linked-image-link-to-object-search-result",{},function(){c.set_link_to_object_id(a(this))}),this.dom.link_to_object_search_selection.on("click",".es-cfct-linked-image-post-information-remove-selected",{},function(){c.unset_link_to_object_id()}),new ES_Widget_Advanced_Options(this.dom.form.find(".es-widget-form-advanced-options"),{auto_open:!0})},c.launch_media_uploader=function(){var a=this;if(!this.dom.choose_image_btn.data("disabled")){var b={frame:function(){return this._frame?this._frame:(this._frame=wp.media({title:"Choose Your Image",library:{type:"image"},button:{text:"Choose Your Image"},multiple:!1}),this._frame.on("open",this.updateFrame).state("library").on("select",this.select),console.log(this._frame.states),this._frame)},select:function(){var c=b.frame().state().get("selection").toJSON(),d=new Array;for(var e in c){var f=c[e];d.push(f.id)}a.set_image(d)},updateFrame:function(){}};b.frame().open()}},c.set_image=function(a){if(!(a.length<1)){var b=a.join(",");this.dom.input_image_ids.val(b),this.load_image_preview(b)}},c.load_image_preview=function(b){var c=this;if(this.disable_choose_button(),b||(b=this.dom.input_image_ids.val()),!b)return this.enable_choose_button(),void 0;var d={action:"es_cfct_linked_image_get_image_preview",image_ids:b};a.post(ajaxurl,d,function(a){c.dom.image_preview.html(a),c.enable_choose_button()})},c.enable_choose_button=function(){this.dom.choose_image_btn.removeClass("es-cfct-linked-image-button-disabled").data("disabled",!1)},c.disable_choose_button=function(){this.dom.choose_image_btn.addClass("es-cfct-linked-image-button-disabled").data("disabled",!0)},c.toggle_link_to_settings=function(){var a=this.dom.widget.find(".es-cfct-linked-image-link-to-checkbox:checked"),b=this.dom.widget.find(".es-cfct-linked-image-link-to-settings");switch(b.hide(),!0){case a.hasClass("es-cfct-linked-image-link_to_lightbox"):break;case a.hasClass("es-cfct-linked-image-link_to_url"):this.dom.link_to_url_settings.show();break;case a.hasClass("es-cfct-linked-image-link_to_object"):this.dom.link_to_object_settings.show();var c=this.dom.input_link_to_object_id.val();this.get_post_information(c)}},c.pendingObjectSearchCall={timeStamp:null,procID:null},c.link_to_object_search_on_change=function(){var b=this,c=this.dom.input_link_to_object_search.val();this.dom.link_to_object_search_results.html(a('<div class="es-cfct-linked-image-ajax-loader"></div>'));var d=Date.now(),e=function(){var e={action:"es_cfct_linked_image_get_object_search_results",search_query:c};a.post(ajaxurl,e,function(a){return b.pendingObjectSearchCall.timeStamp!=d?!1:(b.dom.link_to_object_search_results.html(a),b.pendingObjectSearchCall.procID=null,void 0)})};b.pendingObjectSearchCall.procID&&clearTimeout(b.pendingObjectSearchCall.procID),b.pendingObjectSearchCall={timeStamp:d,procID:setTimeout(e,500)}},c.set_link_to_object_id=function(a){var b=a.data("id");this.dom.input_link_to_object_id.val(b),this.get_post_information(b)},c.unset_link_to_object_id=function(){this.dom.form.find(".es-cfct-linked-image-post-information").remove(),this.dom.input_link_to_object_id.val(null)},c.get_post_information=function(b){var c=this,d={action:"es_cfct_linked_image_get_post_information",post_id:b};a.post(ajaxurl,d,function(a){c.dom.link_to_object_search_selection.html(a)})},d.highlight=function(a){a.attr("style",function(a,b){return b?b.replace(/background-color[^;]+;?/g,""):void 0}),a.stop().effect("highlight",{duration:1e3,color:"rgba(254, 254, 160, 0.51)"})}}window.ES_Linked_Image=b}($);